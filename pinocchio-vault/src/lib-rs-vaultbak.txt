use pinocchio::{AccountView, Address, ProgramResult, entrypoint, error::ProgramError};
use solana_address::declare_id;

use crate::instructions::VaultContext;

mod instructions;
declare_id!("22222222222222222222222222222222222222222222");

entrypoint!(process_instruction);
fn process_instruction(
    _program_id: &Address,
    accounts: &[AccountView],
    instruction_data: &[u8],
) -> ProgramResult {
    // Your program logic goes here
    let (discriminator, instrcution_data) = instruction_data.split_first().ok_or(ProgramError::InvalidInstructionData)?;
    match *discriminator {
        0 => VaultContext::try_from((accounts, instrcution_data, *discriminator))?.deposit()?,
        1 => VaultContext::try_from((accounts, instrcution_data, *discriminator))?.withdraw()?,
        _ => return Err(ProgramError::InvalidInstructionData),
    }  

    Ok(())
}
